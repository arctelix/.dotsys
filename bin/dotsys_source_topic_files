#!/bin/sh

set +o posix

chdir() {
  cd "$@" >/dev/null
}

DOTSYS_FILE_DIRECTORY="$(chdir "${0%/*}" && pwd -P)"
DOTSYS_DOTSYS_FILE="$DOTSYS_FILE_DIRECTORY/${0##*/}"

DOTSYS_PREFIX="${DOTSYS_DOTSYS_FILE%/*/*}"
DOTSYS_REPOSITORY="$DOTSYS_PREFIX"

if [[ -L "$DOTSYS_DOTSYS_FILE" ]]
then
  DOTSYS_SYMLINK="$(readlink "$DOTSYS_DOTSYS_FILE")"
  DOTSYS_SYMLINK_DIRECTORY="$(dirname "$DOTSYS_SYMLINK")"
  DOTSYS_FILE_DIRECTORY="$(chdir "$DOTSYS_FILE_DIRECTORY" &&
                         chdir "$DOTSYS_SYMLINK_DIRECTORY" && pwd -P)"
  DOTSYS_REPOSITORY="${DOTSYS_FILE_DIRECTORY%/*}"
fi

DOTSYS_LIBRARY="$DOTSYS_REPOSITORY/lib"
echo " ==== $DOTSYS_LIBRARY"

source "$DOTSYS_LIBRARY/common.sh"
source "$DOTSYS_LIBRARY/platforms.sh"
source "$DOTSYS_LIBRARY/state.sh"
source "$DOTSYS_LIBRARY/stubs.sh"
echo "-> source_topic_files *.$@"
source_topic_files $@

