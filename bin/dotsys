#!/bin/sh

# Command entry point, see lib/min.sh.
#
# Author: Arctelix (http://gitbub.com/arctelix)
#
# With thanks to the following sources:
# https://github.com/holman/dotfiles
# https://github.com/agross/dotfiles
#
# Dotsys - A platform agnostic package-manager with dotfile integration
#
# Licence: GNU General Public License
# Copyright (C) 2016  Arctelix (http://gitbub.com/arctelix)
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.


# Other useful reference & rationale
# http://superuser.com/questions/789448/choosing-between-bashrc-profile-bash-profile-etc

set +o posix

chdir() {
  cd "$@" >/dev/null
}

DOTSYS_FILE_DIRECTORY="$(chdir "${0%/*}" && pwd -P)"
DOTSYS_DOTSYS_FILE="$DOTSYS_FILE_DIRECTORY/${0##*/}"

DOTSYS_PREFIX="${DOTSYS_DOTSYS_FILE%/*/*}"
DOTSYS_REPOSITORY="$DOTSYS_PREFIX"

if [[ -L "$DOTSYS_DOTSYS_FILE" ]]
then
  DOTSYS_SYMLINK="$(readlink "$DOTSYS_DOTSYS_FILE")"
  DOTSYS_SYMLINK_DIRECTORY="$(dirname "$DOTSYS_SYMLINK")"
  DOTSYS_FILE_DIRECTORY="$(chdir "$DOTSYS_FILE_DIRECTORY" &&
                         chdir "$DOTSYS_SYMLINK_DIRECTORY" && pwd -P)"
  DOTSYS_REPOSITORY="${DOTSYS_FILE_DIRECTORY%/*}"
fi

DOTSYS_LIBRARY="$DOTSYS_REPOSITORY/lib"



# allows testing for all dotsys funcs
if [ "$1" = "ds_test" ]; then
  shift
  source "$DOTSYS_LIBRARY/main.sh"
  DEBUG=true
  echo
  warn "You have entered dotsys test mode!"
  echo
  eval "$1"

# allows access to all common.sh funcs
# (not sure yet if this will be needed)
elif [ "$1" = "ds_utils" ]; then
  shift
  source "$DOTSYS_LIBRARY/utils.sh"
  $@

# call main dotsys func
else
  source "$DOTSYS_LIBRARY/main.sh"
  dotsys "$@"
  echo
fi




